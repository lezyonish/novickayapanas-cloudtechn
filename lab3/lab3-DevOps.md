# DevOps лабораторная 3
## Выполнили: Новицкая Елизавета и Панас Анастасия К3262
- [DevOps лабораторная 3](#devops-лабораторная-3)
  - [Цель](#цель)
  - [Реализация](#реализация)
  - [Итоги](#итоги)

## **Цель:**
Написать файл CI/CD файл с "bad practicies", разобрать, чем они плохи и написать "хороший" CI/CD, исправив все ошибки

[**Перед началом посмотрите короткое видео с мемом**](https://drive.google.com/file/d/1iXaNlQZXCubY0xsm5Ea0_D9FmwqHNQws/view?usp=drivesdk)

## **Реализация:**
- Для работы над данной лабораторной мы на всякий случай создали отдельный репозиторий, чтобы ничего не сломать в нашем, поэтому дальше будет чуть больше скриншотов, чем могло бы быть

<img width="500" src="cat.jpg">

- В терминале перешли в нужную папку, клонировали репозиторий, создали директорию, куда будем заливать наши файлы

<img width="500" src="clone.png">

- Дальше создали файл _bad-ci.yml_ 

<img width="500" src="bad.png">

### **Разберем BAD Practicies**

<img width="500" src="redflag.jpg">

1. ```ubuntu-latest``` - при запуске наш воркфлоу может сломаться из-за несовместимости версий

<details><summary><b>как это исправить?</b></summary>

``` ubuntu-22.04 ``` - решение крайне простое - указать конкретную версию

</details><br>

2. ```git clone https://pviskn:TOKEN@github.com/pviskn/ci-cd.git .``` - ручное копирование может вызвать ошибки (мы тоже на таккое напоролись, когда пытались клонировать по ссылке без ```TOKEN@```)

<img width="500" src="oshibka.png">

<details><summary><b>как это исправить?</b></summary>

``` actions/checkout@v4 ``` - мы предлагаем использовать это действие, чтобы выполнялось безопасное клонирование

</details><br>

3. ```echo "API_KEY=biggest_secret_12345"``` - грубейшее нарушение безопасности, секрет будет виден всем в GitHub Actions

<details><summary><b>как это исправить?</b></summary>

``` ${{ secrets.API_KEY }}``` - передать секрет через GitHub Secrets

...или не использовать вовсе, если секрет не является необходимостью, то нечего нагромождать файл _бэд практиками_
</details><br>

4. ```sudo npm install``` - _sudo_ здесь не нужно, иначе может быть проблема доступа к файлам или с уровнем привилегий

<details><summary><b>как это исправить?</b></summary>

``` actions/setup-node@v4``` - мы предлагаем использовать вот такое действие, которое настраивает окружение Node.js и позволит нам использовать тот же _npm_

</details><br>

5. ```npm test || true``` - мы игнорируем тесты, то есть, если тесты отработают некорректно, то все равно возвращается _true_ , в таком случае полностью ошибочный код будут считать "хорошим"

<details><summary><b>как это исправить?</b></summary>

не игнорировать тесты

<img width="500" src="schock.jpg">

</details><br>


6. Все действия, описанные выше в плохом файле выполняются вместе, поэтому в случае ошибки будет сложно разобраться, какой из блоков кода работает некорректно

<details><summary><b>как это исправить?</b></summary>

решение еще более простое, чем все написанное ранее: просто разделить действия, чтобы они выполнялись по шагам

</details><br>

### **Теперь "хороший" CI/CD файл:**

Исправим все, что описали выше

<img width="500" src="good-ci.png">

Добавили так же запуск на push и PR, чтобы максимально избежать ошибок

Коммитим это все

<img width="500" src="commit.png">


<img width="500" src="total-result.png">

<img width="500" src="good-result.png">

<img width="500" src="bad-result.png">

**УРА, ВСЕ ГАЛОЧКИ**

<img width="500" src="green.jpg">

## **Итоги**

Мы написали "плохой" и "хороший" CI/CD файлы, оба они отработали, мы получили галочки, однако один из них был полон плохих практик, которые мы выявили, изучили и исправили, тем самым достигли поставленной цели.
